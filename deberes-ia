<!DOCTYPE html>
<html>
  <head>
    <title>DeberesIA</title>
    <style>
      body {
        font-family: sans-serif;
        background: #f5f5f5;
        padding: 20px;
      }
      .chatbox {
        background: white;
        border-radius: 10px;
        padding: 20px;
        max-width: 600px;
        margin: auto;
        box-shadow: 0 0 10px #ccc;
      }
      textarea {
        width: 100%;
        height: 80px;
        border-radius: 10px;
        padding: 10px;
        margin-top: 10px;
      }
      button {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 10px;
      }
      #response {
        margin-top: 20px;
      }
      .premium-link {
        display: block;
        margin-top: 15px;
        color: green;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="chatbox">
      <h2>üéì DeberesIA</h2>
      <p>Escribe tu pregunta o ejercicio:</p>
      <textarea id="userInput" placeholder="Ej: Resuelve x¬≤ - 4x + 4 = 0 o Haz un resumen del Romanticismo"></textarea>
      <br>
      <button onclick="sendQuestion()">Enviar</button>
      <a class="premium-link" href="https://tupagina.com/premium" target="_blank">üíé Hazte Premium</a>
      <div id="response"></div>
    </div>

    <script>
      const DAILY_LIMIT = 15;

      function getTodayKey() {
        const today = new Date().toISOString().split('T')[0];
        return `questions_${today}`;
      }

      function getQuestionCount() {
        return parseInt(localStorage.getItem(getTodayKey()) || '0');
      }

      function incrementQuestionCount() {
        const count = getQuestionCount() + 1;
        localStorage.setItem(getTodayKey(), count);
      }

      async function sendQuestion() {
        const responseDiv = document.getElementById('response');
        const question = document.getElementById('userInput').value;

        if (!question.trim()) {
          responseDiv.innerHTML = "<span style='color:red;'>Por favor, escribe una pregunta.</span>";
          return;
        }

        if (getQuestionCount() >= DAILY_LIMIT) {
          responseDiv.innerHTML = `
            <div style="color:red;">
              Has alcanzado el l√≠mite de 15 preguntas gratis hoy. 
              <br><br>
              <strong><a href="https://tupagina.com/premium" target="_blank">Hazte Premium aqu√≠</a></strong>
            </div>`;
          return;
        }

        responseDiv.innerHTML = "Pensando...";

        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer TU_API_KEY' // ‚Üê REEMPLAZA ESTO CON TU API KEY REAL
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [
              {
                role: 'system',
                content: `Eres un profesor experto que ayuda a estudiantes de secundaria y bachillerato a resolver sus tareas. Siempre explicas paso a paso, con un tono amigable y claro, como si estuvieras ense√±ando. Nunca das solo la respuesta final sin explicaci√≥n. Si es una redacci√≥n, la escribes completa. Si es un ejercicio de matem√°ticas, lo resuelves paso a paso. Tu estilo debe ser claro, educativo y breve.`
              },
              {
                role: 'user',
                content: question
              }
            ]
          })
        });

        const data = await res.json();
        const answer = data.choices[0].message.content;
        responseDiv.innerHTML = `<strong>Respuesta:</strong><br>${answer}`;
        incrementQuestionCount();
      }
    </script>
  </body>
</html>
